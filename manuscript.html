<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Oussama Abdoun, Romain Quentin">
<meta name="dcterms.date" content="2023-11-29">

<title>When chance is not random: decoding brain activity in structured sequences. A reevaluation of Demarchi, Sanchez &amp; Weisz 2019</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="manuscript_files/libs/clipboard/clipboard.min.js"></script>
<script src="manuscript_files/libs/quarto-html/quarto.js"></script>
<script src="manuscript_files/libs/quarto-html/popper.min.js"></script>
<script src="manuscript_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="manuscript_files/libs/quarto-html/anchor.min.js"></script>
<link href="manuscript_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="manuscript_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="manuscript_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="manuscript_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="manuscript_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract"><span class="header-section-number">1</span> Abstract</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">2</span> Results</a>
  <ul class="collapse">
  <li><a href="#throwing-the-water" id="toc-throwing-the-water" class="nav-link" data-scroll-target="#throwing-the-water"><span class="header-section-number">2.1</span> Throwing the water</a></li>
  <li><a href="#but-explaining-why" id="toc-but-explaining-why" class="nav-link" data-scroll-target="#but-explaining-why"><span class="header-section-number">2.2</span> But explaining why</a></li>
  <li><a href="#and-saving-the-baby" id="toc-and-saving-the-baby" class="nav-link" data-scroll-target="#and-saving-the-baby"><span class="header-section-number">2.3</span> And saving the baby</a>
  <ul class="collapse">
  <li><a href="#of-future-studies" id="toc-of-future-studies" class="nav-link" data-scroll-target="#of-future-studies"><span class="header-section-number">2.3.1</span> Of future studies</a></li>
  <li><a href="#of-the-demarchi-et-al.-task" id="toc-of-the-demarchi-et-al.-task" class="nav-link" data-scroll-target="#of-the-demarchi-et-al.-task"><span class="header-section-number">2.3.2</span> Of the Demarchi et al.&nbsp;task</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">When chance is not random: decoding brain activity in structured sequences. A reevaluation of Demarchi, Sanchez &amp; Weisz 2019</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Oussama Abdoun, Romain Quentin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 29, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="abstract" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Abstract</h1>
<p>Multivariate pattern analysis using supervised machine learning algorithms has become a common approach to decode neural representations of perceived, retained or anticipated stimuli, among other research goals. Classically, group-level inference is performed by comparing the participant-level performance of a classifier to a baseline, so-called “chance” level. The chance level is the performance expected under the null hypothesis i.e.&nbsp;in the absence of the representation or process of interest. Most often, the chance level is the performance achieved on random, informationless data and will be taken as 1 over the number of classes. However, in some experimental designs the null baseline may contain information that is not fully orthogonal to the effect of interest. We investigate this phenomenon in the context of decoding anticipatory neural signals in statistical sequences of pure tones. We provide a mathematical demonstration that chance level may actually be lower or higher than 1 over class number, depending on the correlation between the transition matrix of the structured sequence and the confusion matrix of the classifier. We illustrate this on a real MEG dataset (Demarchi et al.&nbsp;2019) and reevaluate the conclusions of the original study using empirical chance levels.</p>
</section>
<section id="results" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Results</h1>
<section id="throwing-the-water" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="throwing-the-water"><span class="header-section-number">2.1</span> Throwing the water</h2>
<p>Demarchi et al.&nbsp;have reached their conclusions by performing null hypothesis statistical testing (NHST) on decoding accuracy (with cluster-level, permutation-based correction for multiple comparisons, but this aspect of their procedure is irrelevant here). NHST requires the specification of an operational null hypothesis, i.e.&nbsp;the value that the mean of a population parameter is expected to take if the phenomenon of interest was assumed to not exist. Here, the phenomenon of interest is <em>brain anticipatory activation patterns collinear with sensory-evoked activation</em>; the population parameter is the <em>accuracy of a linear decoder</em> trained on evoked data from random sequences and tested on pre-stimulus data embedded in low entropy sequences; the null hypothesis is <em>0.25</em>.</p>
<p>However, upon further inspection it appears that the assumed value of the null hypothesis is incorrect. More specifically, the true null hypothesis is actually higher than 0.25 at every timepoint where stimullus identity can be decode from brain data. We demonstrate it by reconstructing a true null hypothesis in two ways:</p>
<ol type="1">
<li><p>by training a linear decoder the same way as in Demarchi et al., but then testing it on data coming from random sequences but reordered stimulus-wise so as to reproduce the sequences of stimuli actually presented to participants in low entropy conditions</p></li>
<li><p>by extracting the confusion matrices from the same linear decoder, and applying it to the sequences of stimuli presented to participants in low entropy conditions in a data-independent manner</p></li>
</ol>
<p>As expected, both methods are equivalent and give the exact same numerical results. More interestingly, those results are statistically indistinguishable from the patterns reported by Demarchi et al.&nbsp;which they interpret.</p>
</section>
<section id="but-explaining-why" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="but-explaining-why"><span class="header-section-number">2.2</span> But explaining why</h2>
<p>In a second step, we show why the true null hypothesis is systematically higher than the intuitive so-called “chance level” of 0.25. This is due to the transition matrix and the matrix confusion not being fully orthogonal (on average, at the group level). More specifically, it can be mathematically demonstrated that the true null hypothesis depends on the covariance between the rows of the transition matrix and the corresponding rows of the confusion matrix.</p>
<p>Let denote <span class="math inline">\(T\)</span> a plausible <span class="math inline">\(4 \times 4\)</span> transition matrix and <span class="math inline">\(C\)</span> a plausible <span class="math inline">\(4 \times 4\)</span> confusion matrix.</p>
<p>We accept <span class="math inline">\(T\)</span> as a plausible transition matrix if <span class="math inline">\(T\)</span>:</p>
<ul>
<li><p>describes a simple Markov process: <span class="math inline">\(\forall i, \sum_{j} T_{i,j}=1\)</span> (the rowwise sum is equal to 1)</p></li>
<li><p>with equi-probable states: <span class="math inline">\(\lim_{n\to\infty} T^n = \frac{1}{4}J_4\)</span> where <span class="math inline">\(J_4\)</span> is a <span class="math inline">\(4 \times 4\)</span> matrix of ones</p></li>
</ul>
<p>We take <span class="math inline">\(C\)</span> to be a plausible confusion matrix if it satisfies two conditions:</p>
<ul>
<li><p>the rowwise sum is equal to 1: <span class="math inline">\(\forall i, \sum_{j} C_{i,j}=1\)</span></p></li>
<li><p>the decoder is accurate, in that it is more likely to find the true stimulus identity on average: <span class="math inline">\(\forall{i,j} \in \{1,...,4\}, C_{i,i} \geq C_{i,j}\)</span></p></li>
</ul>
<p>Starting from the definition of the covariance between row <span class="math inline">\(i\)</span> of <span class="math inline">\(T\)</span> and row <span class="math inline">\(i\)</span> of <span class="math inline">\(C\)</span>, we have:</p>
<p><span class="math display">\[\begin{aligned}
Cov(T_i,C_i)
&amp;= \mathbb{E}\big[\big(T_i-\mathbb{E}(T_i)\big) \big(C_i-\mathbb{E}(C_i)\big) \big]\\
&amp;= \mathbb{E}(T_i C_i) - \mathbb{E}(T_i)\mathbb{E}(C_i) \\
&amp;= \mathbb{E}(T_i C_i) - \frac{1}{16}
\end{aligned}\]</span> <!-- \sigma_{T_i} \sigma_{C_i} r_{T_i,C_i} --> <!-- &= \sum_{i}(T_{i,j}-\bar T_{j})(C_{i,j}-\bar C_{j}) \\ --> <!-- &= \sum_{i}T_{i,j}C_{i,j} - \sum_{i}\bar T_{j}C_{i,j} - \sum_{i}\bar C_{j}T_{i,j} + \sum_{i}\bar C_{j} \bar T_{j} \\ --> <!-- &= \sum_{i}T_{i,j}C_{i,j} - \bar T_{j} - \bar C_{j} + 4\bar C_{j} \bar T_{j} --></p>
<p>If the current stimulus <span class="math inline">\(S_0\)</span> is <span class="math inline">\(j\)</span>, than the probability that it is decoded by chance (i.e.&nbsp;under true null hypothesis) from the preceding trial <span class="math inline">\(S_{-1}\)</span> is:</p>
<p><span class="math inline">\(p(j|H_0) = \sum_{i} T_{i,j}C_{i,j}\)</span></p>
<p>Therefore, the global chance level is:</p>
<p><span class="math inline">\(p = \frac{1}{4} \sum_{j} \sum_{i} T_{i,j}C_{i,j} = \sum_{i} \mathbb{E}[T_i C_i]\)</span></p>
<p>Which, combined with the expression of the covariance above, can be rewritten as: <span class="math display">\[\begin{aligned}
p
&amp;= \sum_{i} \bigg(\frac{1}{16} + Cov(T_i,C_i) \bigg) \\
&amp;= \frac{1}{4} + \sum_{i} Cov(T_i,C_i)
\end{aligned}\]</span></p>
<p>Said otherwise, the empirical chance level deviates from the theoretical value (one over class number) by the summed covariances between the rows of the transition and confusion matrices.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CHECK formula</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Demarchi et al. transition matrix (ORD condition)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(.<span class="dv">25</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">75</span>, .<span class="dv">75</span>,.<span class="dv">25</span>,<span class="dv">0</span>,<span class="dv">0</span>, <span class="dv">0</span>,.<span class="dv">75</span>,.<span class="dv">25</span>,<span class="dv">0</span>, <span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">75</span>,.<span class="dv">25</span>), <span class="at">ncol=</span><span class="dv">4</span>, <span class="at">byrow =</span> T)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Demarchi et al. confusion matrix (RAND condition)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(.<span class="dv">40</span>,.<span class="dv">26</span>,.<span class="dv">18</span>,.<span class="dv">23</span>, .<span class="dv">22</span>,.<span class="dv">29</span>,.<span class="dv">21</span>,.<span class="dv">17</span>, .<span class="dv">17</span>,.<span class="dv">25</span>,.<span class="dv">38</span>,.<span class="dv">25</span>, .<span class="dv">21</span>,.<span class="dv">20</span>,.<span class="dv">23</span>,.<span class="dv">35</span>), <span class="at">ncol=</span><span class="dv">4</span>, <span class="at">byrow =</span> T))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --- calculate global chance level</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(T[,<span class="dv">1</span>]<span class="sc">*</span>C[,<span class="dv">1</span>] <span class="sc">+</span> T[,<span class="dv">2</span>]<span class="sc">*</span>C[,<span class="dv">2</span>] <span class="sc">+</span> T[,<span class="dv">3</span>]<span class="sc">*</span>C[,<span class="dv">3</span>] <span class="sc">+</span> T[,<span class="dv">4</span>]<span class="sc">*</span>C[,<span class="dv">4</span>])<span class="sc">/</span><span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.263125</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- calculate average</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to use our own definition of covariance because R's cov() uses unbiased standard deviation, with n-1 denominators...</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>cov_biased <span class="ot">&lt;-</span> <span class="cf">function</span>(X,Y) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(X<span class="sc">*</span>Y)<span class="sc">-</span><span class="fu">mean</span>(X)<span class="sc">*</span><span class="fu">mean</span>(Y))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cov_biased</span>(T[<span class="dv">1</span>,],C[<span class="dv">1</span>,]) <span class="sc">+</span> <span class="fu">cov_biased</span>(T[<span class="dv">2</span>,],C[<span class="dv">2</span>,]) <span class="sc">+</span> <span class="fu">cov_biased</span>(T[<span class="dv">3</span>,],C[<span class="dv">3</span>,]) <span class="sc">+</span> <span class="fu">cov_biased</span>(T[<span class="dv">4</span>,],C[<span class="dv">4</span>,]) <span class="sc">+</span> .<span class="dv">25</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.263125</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># =&gt; the two quantities are equal !</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="and-saving-the-baby" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="and-saving-the-baby"><span class="header-section-number">2.3</span> And saving the baby</h2>
<section id="of-future-studies" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="of-future-studies"><span class="header-section-number">2.3.1</span> Of future studies</h3>
<p>The fact that above chance level null hypothesis is induced by correlation between transition and confusion matrices offers at least two solutions:</p>
<ul>
<li><p>orthogonalize the two matrices by making off-diagonal elements of the confusion matrix equal: this might prove difficult, and seems only possible if all stimuli are at equal distances in the perceptual space</p></li>
<li><p>orthogonalize the two matrices at the level of the group, by systematically varying transition matrices between participants: considering that the confusion matrix obtained from random-sequence data is independent from the transition matrix, zero correlation at the group level should be obtained by varying transition matrices that the group-averaged transition matrix is fully random</p></li>
</ul>
<p>Even after taking these precautions, we do not recommend proceeding with the tests assuming that H0=0.25, for at least two reasons. A minor one is that control (of the perceptual space, or of the group-average transition matrix) may have not be perfect and some bias may remain. The major reason is that the final inference is performed by comparing the sample distribution of participant-level differences from chance level to 0, and such distribution will have a higher variance if chance level is taken uniformly equal to 0.25 rather than calculated empirically participant-wise as per the equations above. Therefore, the latter approach will have greater statistical power.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>chance.lvls <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="fl">0.235</span>,<span class="fl">0.265</span>,<span class="fl">0.001</span>))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(chance.lvls) </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>perf.mean <span class="ot">&lt;-</span> <span class="fl">0.010</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>perf.sd <span class="ot">&lt;-</span> <span class="fl">0.015</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> chance.lvls <span class="sc">+</span> <span class="fu">rnorm</span>(n, perf.mean, perf.sd)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>df.plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(chance.lvls, perf, <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span>n)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.plot, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> perf)) <span class="sc">+</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> x, <span class="at">yend =</span> chance.lvls, <span class="at">color =</span> <span class="fu">as.factor</span>(<span class="fu">sign</span>(perf<span class="sc">-</span>chance.lvls)))) <span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">16</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> chance.lvls), <span class="at">shape =</span> <span class="dv">3</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">31</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"participant"</span>, <span class="at">y =</span> <span class="st">"performance"</span>) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>()) <span class="ot">-&gt;</span> g1</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.plot, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> perf)) <span class="sc">+</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.25</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.25</span><span class="sc">+</span>perf.mean, <span class="at">color =</span> <span class="st">"firebrick"</span>) <span class="sc">+</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_violin() +</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(position = position_jitter(0.1)) +</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"power = "</span>, <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span><span class="fu">pwr.t.test</span>(<span class="at">d =</span> perf.mean<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">sd</span>(chance.lvls)<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>perf.sd<span class="sc">^</span><span class="dv">2</span>), <span class="at">n =</span> n)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span>power), <span class="st">"%"</span>)) <span class="sc">+</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">c</span>(.<span class="dv">20</span>,.<span class="dv">30</span>)) <span class="sc">+</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">x =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"performance"</span>) <span class="sc">+</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="ot">-&gt;</span> g2</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.plot, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> perf<span class="sc">-</span>chance.lvls)) <span class="sc">+</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span><span class="sc">+</span>perf.mean, <span class="at">color =</span> <span class="st">"firebrick"</span>) <span class="sc">+</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_violin() +</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(position = position_jitter(0.1)) +</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"power = "</span>, <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span><span class="fu">pwr.t.test</span>(<span class="at">d =</span> perf.mean<span class="sc">/</span>perf.sd, <span class="at">n =</span> n)<span class="sc">$</span>power), <span class="st">"%"</span>)) <span class="sc">+</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">x =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">05</span>,.<span class="dv">05</span>)) <span class="sc">+</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"performance - chance level"</span>) <span class="sc">+</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="ot">-&gt;</span> g3</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="co"># sqrt(sd(chance.lvls)^2+perf.sd^2)</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="co"># sd(chance.lvls)</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="co"># perf.sd^2</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>g1 <span class="sc">/</span> (g2<span class="sc">+</span>g3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="manuscript_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="576"></p>
</div>
</div>
</section>
<section id="of-the-demarchi-et-al.-task" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="of-the-demarchi-et-al.-task"><span class="header-section-number">2.3.2</span> Of the Demarchi et al.&nbsp;task</h3>
<p>We have demonstrated that the pre-stimulus decoding activity interpreted by Demarchi et al.&nbsp;as anticipatory activity was actually expected under the null hypothesis. However, that does not completely rule out the possibility of (linear) anticipatory activity:</p>
<ol type="1">
<li><p>could be revealed by fair decoding</p></li>
<li><p>could be present in the form of brain activity distinct from stimulus-evoked activity. To test that, compare <span class="math inline">\(train_{ORD},test_{ORD}\)</span> with <span class="math inline">\(train_{RAND},test_{ORD}\)</span>: the latter should only contain stimulus-evoked activity, the former both stimulus-evoked and anticipatory activity. The difference between the two should be parametrically modulated by sequence entropy.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>